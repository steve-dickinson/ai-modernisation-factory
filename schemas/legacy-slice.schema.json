{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Legacy Slice",
  "type": "object",
  "additionalProperties": false,
  "required": ["system", "slice", "cdp", "preserve", "scope", "acceptance", "handoff", "integration"],
  "properties": {
    "system": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "repo"],
      "properties": {
        "name": { "type": "string" },
        "repo": { "type": "string" }
      }
    },
    "slice": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "name", "goal", "riskLevel"],
      "properties": {
        "id": { "type": "string", "pattern": "^slice-[0-9]{3}$" },
        "name": { "type": "string" },
        "goal": { "type": "string" },
        "riskLevel": { "type": "string", "enum": ["low", "medium", "high"] }
      }
    },
    "cdp": {
      "type": "object",
      "additionalProperties": false,
      "required": ["template", "serviceType", "repoName"],
      "properties": {
        "template": { "type": "string", "enum": ["cdp-node-backend-template", "cdp-node-frontend-template"] },
        "serviceType": { "type": "string", "enum": ["api", "worker", "frontend"] },
        "repoName": { "type": "string" }
      }
    },
    "preserve": {
      "type": "object",
      "additionalProperties": false,
      "required": ["interfaces", "contracts", "invariants"],
      "properties": {
        "interfaces": { "type": "array", "minItems": 1, "items": { "type": "string" } },
        "contracts": { "type": "array", "minItems": 1, "items": { "type": "string" } },
        "invariants": { "type": "array", "minItems": 1, "items": { "type": "string" } }
      }
    },
    "scope": {
      "type": "object",
      "additionalProperties": false,
      "required": ["in", "out"],
      "properties": {
        "in": { "type": "array", "minItems": 1, "items": { "type": "string" } },
        "out": { "type": "array", "minItems": 1, "items": { "type": "string" } }
      }
    },
    "acceptance": {
      "type": "array",
      "minItems": 3,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["test", "howToVerify", "evidenceFromObserve"],
        "properties": {
          "test": { "type": "string" },
          "howToVerify": { "type": "string" },
          "evidenceFromObserve": { "type": "array", "minItems": 1, "items": { "type": "string" } }
        }
      }
    },
    "handoff": {
      "type": "object",
      "additionalProperties": false,
      "required": ["nextSliceSuggestion", "openQuestions"],
      "properties": {
        "nextSliceSuggestion": { "type": "string" },
        "openQuestions": { "type": "array", "minItems": 1, "items": { "type": "string" } }
      }
    },
    "integration": {
      "type": "object",
      "required": ["mode"],
      "additionalProperties": false,
      "properties": {
        "mode": { "type": "string", "enum": ["shim", "integrate"] },
        "dependencies": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
